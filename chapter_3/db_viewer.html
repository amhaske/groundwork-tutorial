
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>3.2. Database views made simple &#8212; groundwork tutorial 0.1 documentation</title>
    <link rel="stylesheet" href="../_static/groundwork.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.3. Creating own web content" href="own_view.html" />
    <link rel="prev" title="3.1. Web application setup" href="web_setup.html" />
     
        
    <link rel="apple-touch-icon" href="../_static/""" />
        
    <link media="only screen and (max-device-width: 480px)" href="../_static/small_groundwork.css" type= "text/css" rel="stylesheet" />
    <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">
    <!-- Place this tag in your head or just before your close body tag. -->

  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="own_view.html" title="3.3. Creating own web content"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="web_setup.html" title="3.1. Web application setup"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">groundwork tutorial 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">3. groundwork and the web</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="database-views-made-simple">
<span id="db-viewer"></span><h1>3.2. Database views made simple<a class="headerlink" href="#database-views-made-simple" title="Permalink to this headline">¶</a></h1>
<p>Now it’s time to use the magic of groundwork patterns to easily extend a plugins functionality.</p>
<p>We will just modify 3-4 lines to get a web view for our database models. This views can then be used to create,
read, update and delete model data in our database.</p>
<div class="section" id="web-view">
<h2>3.2.1. Web view<a class="headerlink" href="#web-view" title="Permalink to this headline">¶</a></h2>
<p>We will update our Plugin <code class="docutils literal"><span class="pre">CsvWatcherDbPlugin</span></code> to register views for its models.</p>
<p>So open the file <code class="docutils literal"><span class="pre">csv_watcher_db_plugin.py</span></code> and replace the content with the following code.
Changed lines are highlighted.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">click</span> <span class="kn">import</span> <span class="n">Argument</span><span class="p">,</span> <span class="n">Option</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span>
<span class="hll"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">url_for</span>
</span>
<span class="kn">from</span> <span class="nn">groundwork.patterns</span> <span class="kn">import</span> <span class="n">GwCommandsPattern</span>
<span class="hll"><span class="c1"># from groundwork_database.patterns import GwSqlPattern #  No longer needed, as GwWebDbAdminPattern inherits from it.</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">groundwork_web.patterns</span> <span class="kn">import</span> <span class="n">GwWebDbAdminPattern</span><span class="p">,</span> <span class="n">GwWebDbRestPattern</span>
</span><span class="kn">from</span> <span class="nn">csv_manager.patterns</span> <span class="kn">import</span> <span class="n">CsvWatcherPattern</span>


<span class="hll"><span class="k">class</span> <span class="nc">CsvWatcherDbPlugin</span><span class="p">(</span><span class="n">GwCommandsPattern</span><span class="p">,</span> <span class="n">CsvWatcherPattern</span><span class="p">,</span> <span class="n">GwWebDbAdminPattern</span><span class="p">):</span>
</span>    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A plugin for monitoring csv files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;CsvWatcherDbPlugin&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Watcher</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># Argument for our command, which stores the csv file path.</span>
        <span class="n">path_argument</span> <span class="o">=</span> <span class="n">Argument</span><span class="p">((</span><span class="s2">&quot;csv_file&quot;</span><span class="p">,),</span>
                                 <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                 <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

        <span class="n">interval_option</span> <span class="o">=</span> <span class="n">Option</span><span class="p">((</span><span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="s2">&quot;--interval&quot;</span><span class="p">),</span>
                                 <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                                 <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                 <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Sets the time between two checks in seconds&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;csv_watcher_list&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;Shows all csv watchers&quot;</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">csv_watcher_list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;csv_watcher_add&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;Adds a permanent watcher&quot;</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">csv_watcher_add</span><span class="p">,</span>
                               <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="n">path_argument</span><span class="p">,</span> <span class="n">interval_option</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;csv_watcher_delete&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;Removes a permanent watcher&quot;</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">csv_watcher_delete</span><span class="p">,</span>
                               <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="n">path_argument</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_db</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_watchers</span><span class="p">()</span>

<span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Watcher</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
</span>
<span class="hll">        <span class="k">try</span><span class="p">:</span>
</span><span class="hll">            <span class="n">menu_csv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">menus</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;CSV&quot;</span><span class="p">,</span> <span class="n">link</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
</span><span class="hll">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span class="hll">            <span class="n">menu_csv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">menus</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;CSV&quot;</span><span class="p">)</span>
</span><span class="hll">        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">flask</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
</span><span class="hll">            <span class="c1"># Will be http://127.0.0.1:5000/admin/admin_csvwatchers/</span>
</span><span class="hll">            <span class="n">menu_csv</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Watchers&quot;</span><span class="p">,</span> <span class="n">link</span><span class="o">=</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;admin_csvwatchers.index_view&quot;</span><span class="p">))</span>
</span>
    <span class="k">def</span> <span class="nf">setup_db</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">databases</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;WATCHER_DATABASE_NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;csv_watcher_db&quot;</span><span class="p">),</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;WATCHER_DATABASE_CONNECTION&quot;</span><span class="p">,</span> <span class="s2">&quot;sqlite://&quot;</span><span class="p">),</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;WATCHER_DATABASE_DESCRIPTION&quot;</span><span class="p">,</span> <span class="s2">&quot;Stores csv watchers&quot;</span><span class="p">))</span>
        <span class="n">Base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">Base</span>

        <span class="k">class</span> <span class="nc">CsvWatchers</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
            <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;csv_watchers&#39;</span>

            <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">csv_file</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">2048</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Watcher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">CsvWatchers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_watchers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">current_watchers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Watcher</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">watcher</span> <span class="ow">in</span> <span class="n">current_watchers</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">activate_watcher</span><span class="p">(</span><span class="n">watcher</span><span class="o">.</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">watcher</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t activate watcher for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">watcher</span><span class="o">.</span><span class="n">csv_file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">csv_watcher_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">watchers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Watcher</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">watcher</span> <span class="ow">in</span> <span class="n">watchers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;file: </span><span class="si">%s</span><span class="s2"> - interval: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">watcher</span><span class="o">.</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">watcher</span><span class="o">.</span><span class="n">interval</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">csv_watcher_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csv_file</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
        <span class="n">watcher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Watcher</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">csv_file</span><span class="o">=</span><span class="n">csv_file</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">watcher</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;csv file </span><span class="si">%s</span><span class="s2"> already exists in database.&quot;</span> <span class="o">%</span> <span class="n">watcher</span><span class="o">.</span><span class="n">csv_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">watcher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Watcher</span><span class="p">(</span><span class="n">csv_file</span><span class="o">=</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">watcher</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t create csv_file </span><span class="si">%s</span><span class="s2"> in database&quot;</span> <span class="o">%</span> <span class="n">csv_file</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">activate_watcher</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">interval</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">csv_watcher_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csv_file</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Watcher</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">csv_file</span><span class="o">=</span><span class="n">csv_file</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Watcher for </span><span class="si">%s</span><span class="s2"> removed&quot;</span> <span class="o">%</span> <span class="n">csv_file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">activate_watcher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csv_file</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Register thread</span>
            <span class="n">watcher_thread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csv_watcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">interval</span><span class="p">,</span> <span class="s2">&quot;Watcher for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">csv_file</span><span class="p">)</span>

            <span class="c1"># Start thread</span>
            <span class="k">if</span> <span class="n">watcher_thread</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">watcher_thread</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">((</span><span class="s2">&quot;Watcher started for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">csv_file</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</td></tr></table></div>
<p>As you can see, we haven’t made much changes.
We replaced an import and added some new code lines to the <code class="docutils literal"><span class="pre">activation()</span></code> routine.</p>
<p>Instead of <code class="docutils literal"><span class="pre">GwSqlPattern</span></code> we use the <code class="docutils literal"><span class="pre">GwWebDbAdminPattern</span></code> from the groundwork-web package [7].
This pattern inherits itself from <code class="docutils literal"><span class="pre">GwSqlPattern</span></code>, so that all functions of this pattern are still available.
So we also changed our class definition to inherit from <code class="docutils literal"><span class="pre">GwWebDbAdminPattern</span></code> [11].</p>
<p>In line 51 we used the functions <code class="docutils literal"><span class="pre">self.web.db.register()</span></code> from <code class="docutils literal"><span class="pre">GwWebDbAdminPattern</span></code> to register our database model <strong>self.Watcher</strong>.
This will automatically activate the views and functions we need to change model data in our browser.</p>
<p>Finally we need a link to the just created view, so that the user must not guess under which url he or she can
edit the model.
So in the lines 53 - 59 we register a menu entry, which will be shown on each page.
Some magic happens in line 59: We use the flask function <code class="docutils literal"><span class="pre">url_for()</span></code> to calculate the correct url for us.
Url links are changing in web applications very often and should never be hard coded somewhere in your code.
<code class="docutils literal"><span class="pre">url_for()</span></code> helps us to generate a valid url based on the given view name.</p>
<p>Now restart your server</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">csv_manager</span> <span class="n">server_start</span> <span class="n">flask_debug</span>
</pre></div>
</div>
<p>Open the WebManager at <a class="reference external" href="http://127.0.0.1:5000/webmanager/">http://127.0.0.1:5000/webmanager/</a>.</p>
<p>You should see a new menu entry on the top left of your page. Click it and you will see a table of all csv files,
which were stored inside your database. You are free to use the buttons to create, update or delete some of the data.</p>
<div class="figure" id="id1">
<img alt="../_images/db_web_view.png" src="../_images/db_web_view.png" />
<p class="caption"><span class="caption-text">View of the database table of the model <strong>CsvWatchers</strong></span></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>groundwork is using <a class="reference external" href="https://flask-admin.readthedocs.io/en/latest/">flask-admin</a>
for providing database views.</p>
<p class="last">Please read the flask-admin documentation for more information how to interact with your new web views.</p>
</div>
</div>
<div class="section" id="rest-view">
<h2>3.2.2. REST view<a class="headerlink" href="#rest-view" title="Permalink to this headline">¶</a></h2>
<p>Now our users have a nice interface to edit database entries.</p>
<p>But what if an external script needs to make changes to our database and we do not want give direct
database access to it? For this case we can use
<a class="reference external" href="https://en.wikipedia.org/wiki/Representational_state_transfer">REST</a>.</p>
<p>The creation of a REST interface is as easy as the creation of a web interface for a database model.
Just add the following code to the related parts of <code class="docutils literal"><span class="pre">csv_watcher_db_plugin.py</span></code>:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#  other imports</span>

<span class="kn">from</span> <span class="nn">flask_restless</span> <span class="kn">import</span> <span class="n">url_for</span> <span class="k">as</span> <span class="n">rest_url_for</span>
<span class="kn">from</span> <span class="nn">groundwork_web.patterns</span> <span class="kn">import</span> <span class="n">GwWebDbRestPattern</span>

<span class="k">class</span> <span class="nc">CsvWatcherDbPlugin</span><span class="p">(</span><span class="n">GwCommandsPattern</span><span class="p">,</span> <span class="n">CsvWatcherPattern</span><span class="p">,</span> <span class="n">GwWebDbAdminPattern</span><span class="p">,</span> <span class="n">GwWebDbRestPattern</span><span class="p">):</span>

<span class="c1"># ...</span>

<span class="k">def</span> <span class="nf">activate</span><span class="p">():</span>
<span class="c1"># ...</span>

<span class="bp">self</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Watcher</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
     <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">flask</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
         <span class="n">menu_csv</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;REST CsvWatchers&quot;</span><span class="p">,</span> <span class="n">link</span><span class="o">=</span><span class="n">rest_url_for</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Watcher</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<p>After a server restart you can see your REST API in action by visiting <a class="reference external" href="http://127.0.0.1:5000/api/csv_watchers">http://127.0.0.1:5000/api/csv_watchers</a>:</p>
<div class="figure align-center" id="id2">
<img alt="../_images/db_web_rest.png" src="../_images/db_web_rest.png" />
<p class="caption"><span class="caption-text">REST interface of the database table of the model <strong>CsvWatchers</strong></span></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>groundwork is using <a class="reference external" href="https://flask-restless.readthedocs.io/en/stable/">flask-restless</a>
for providing REST interfaces.</p>
<p class="last">Please read the flask-restless documentation for more information how to interact with your new
REST interface.</p>
</div>
<p>Great, you just learned how easy it is to set up views and interfaces to database models. Without any need
to care about HTML, CSS, form validation or any other web related technology.</p>
<p>But luckily we will use these technologies to create our own web view on the next chapter <a class="reference internal" href="own_view.html#own-view"><span class="std std-ref">Creating own web content</span></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/gw_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3.2. Database views made simple</a><ul>
<li><a class="reference internal" href="#web-view">3.2.1. Web view</a></li>
<li><a class="reference internal" href="#rest-view">3.2.2. REST view</a></li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">3. groundwork and the web</a><ul>
      <li>Previous: <a href="web_setup.html" title="previous chapter">3.1. Web application setup</a></li>
      <li>Next: <a href="own_view.html" title="next chapter">3.3. Creating own web content</a></li>
  </ul></li>
  </ul></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/chapter_3/db_viewer.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
    
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>





















        </div>
      </div>
      <div class="clearer"></div>
    </div>
 
        <div class="github_fork">
            <a href="http://github.com/useblocks/groundwork-tutorial">
                <img style="position: fixed; top: 0; right: 0; border: 0;"
                     src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png"
                     alt="Fork me on GitHub">
            </a>
        </div>
    


    <div class="footer">
      &copy; Copyright 2017, team useblocks.
    </div>
  </body>
</html>